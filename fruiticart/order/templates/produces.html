<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Produces</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'styles/main.css' %}">
    <style>
        img {
            width: 150px;
            height: auto;
            border-radius: 8px;
        }
        .product {
            margin-bottom: 20px;
        }

        .cart-logo {
            width: 20px;
            height: auto;
            margin-right: 8px;
        }
    </style>
</head>

<body>
    {% include 'navbar.html' %}
    
    <header>
        <h1>Fresh produces</h1>
        <p>Select quantity for each fruit and vegetable</p>
    </header>

    <section>
        <!-- placeholder for the items, generated at the loading -->
    </section>

    <footer>
        {% include 'footer.html' %}
    </footer>

    <script id="config" type="application/json">
        {
          "staticBaseUrl": "{% static '' %}"
        }
    </script>

    <script>
        var config = JSON.parse(document.getElementById('config').textContent);
        var staticBaseUrl = config.staticBaseUrl;

        function goToCart() {
            // update quantities
            updateQuantities();

            // check that at least one item is selected
            var cartItems = JSON.parse(localStorage.getItem("cartItems")) || {};
            var cartItemsArray = Object.values(cartItems);
            var cartItemsSum = cartItemsArray.reduce((a, b) => a + b, 0);

            if (cartItemsSum === 0) {
                alert("Please select at least one item");
                return;
            }
            
            window.location.href = "/order/order_infos/";
        }

        function updateQuantities() {
            var products = document.querySelectorAll(".product");

            var cartItems = {};

            products.forEach(function (product) {
                var productId = product.id;
                var quantity = parseInt(document.getElementById(productId + "-quantity").value) || 0;

                if (quantity > 0) {
                    cartItems[productId] = quantity;
                }
            });

            localStorage.setItem("cartItems", JSON.stringify(cartItems));
        }

        function initPage() {
            // initialize cart
            var cartItems = JSON.parse(localStorage.getItem("cartItems")) || {};
        
            // initialize items
            var products = [
                { id: "orange", name: "Orange", price: "1.64€/kg" },
                { id: "apple", name: "Apple", price: "1.99€/kg" },
                { id: "banana", name: "Banana", price: "1.99€/kg" },
                { id: "strawberry", name: "Strawberry", price: "4.58€/kg" },
                { id: "cherry", name: "Cherry", price: "11.99€/kg" },
                { id: "pear", name: "Pear", price: "2.69€/kg" },
                { id: "peach", name: "Peach", price: "2.99€/kg" },
                { id: "kiwi", name: "Kiwi", price: "2.99€/kg" },
                { id: "lemon", name: "Lemon", price: "2.98€/kg" },
                { id: "grape", name: "Grape", price: "6.00€/kg" },
                { id: "pineapple", name: "Pineapple", price: "3.99€ per unit" },
                { id: "watermelon", name: "Watermelon", price: "4.79€ per unit" },
                { id: "carrot", name: "Carrot", price: "1.39€/kg" },
                { id: "tomato", name: "Tomato", price: "1.39€/kg" },
                { id: "peppers", name: "Peppers", price: "3.99€/kg" },
                { id: "cucumber", name: "Cucumber", price: "1.69 per unit" },
                { id: "potato", name: "Potato", price: "0.99€/kg" },
                { id: "onion", name: "Onion", price: "2.69€/kg" },
                { id: "garlic", name: "Garlic", price: "4.09€/500g" },
                { id: "eggplant", name: "Eggplant", price: "4.58€/kg" }
            ];

            // loop through items and create elements
            for (var i = 0; i < products.length; i++) {
                var product = products[i];
                var productId = product.id;

                // create product div
                var productDiv = document.createElement("div");
                productDiv.classList.add("product");
                productDiv.id = productId;

                // create product image
                var productImage = document.createElement("img");
                productImage.src = staticBaseUrl + productId + ".jpg";
                productImage.alt = product.name;
                productDiv.appendChild(productImage);

                // create product name
                var productName = document.createElement("h2");
                productName.textContent = product.name;
                productDiv.appendChild(productName);

                // create product price
                var productPrice = document.createElement("p");
                productPrice.textContent = "Price: " + product.price;
                productDiv.appendChild(productPrice);

                // create product quantity
                var quantityLabel = document.createElement("label");
                quantityLabel.setAttribute("for", productId + "-quantity");
                quantityLabel.textContent = "Quantity:";
                productDiv.appendChild(quantityLabel);

                var quantityInput = document.createElement("input");
                quantityInput.setAttribute("type", "number");
                quantityInput.setAttribute("id", productId + "-quantity");
                quantityInput.classList.add("quantity");
                quantityInput.setAttribute("value", "0");
                quantityInput.setAttribute("min", "0");
                productDiv.appendChild(quantityInput);

                // add product div to section
                document.querySelector("section").appendChild(productDiv);
            }

            // add submit-button with its image
            var submitButton = document.createElement("button");
            submitButton.classList.add("submit-button");
            submitButton.textContent = "Go to cart";
            submitButton.onclick = goToCart;

            var cartLogo = document.createElement("img");
            cartLogo.src = "{% static 'cart_logo.jpeg' %}";
            cartLogo.alt = "Cart Logo";
            cartLogo.classList.add("cart-logo");

            submitButton.prepend(cartLogo);
            document.querySelector("section").appendChild(submitButton);
        }

        window.onload = initPage;
    </script>
</body>

</html>